<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta name="viewport" content="width=device-width" />
    <meta charset="utf-8" />
    <link rel="canonical" href="https://code-logs.github.io/yarn-berry로-구성하는-monorepo" />
    <link rel="apple-touch-icon" href="/icons/icon-192x-192.png" />
    <link rel="manifest" href="/manifest.json" />
    <meta name="theme-color" content="#fff" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Code Logs" />
    <meta name="author" content="Jay Lee" />
    <meta
      name="keyword"
      content="berry, monorepo, workspace, workspaces, yarn, yarn berry, zero-install, 모노리포, yarn berry로 구성하는 monorepo, yarn berry와 yarn workspaces를 이용해 monorepo 구성 - 환경 설정, 샘플 프로젝트, infrastructure"
    />
    <meta name="description" content="yarn berry와 yarn workspaces를 이용해 monorepo 구성 - 환경 설정, 샘플 프로젝트" />
    <meta property="og:description" content="yarn berry와 yarn workspaces를 이용해 monorepo 구성 - 환경 설정, 샘플 프로젝트" />
    <meta property="og:title" content="yarn berry로 구성하는 monorepo | Code Logs" />
    <meta property="og:url" content="https://code-logs.github.io/yarn-berry로-구성하는-monorepo" />
    <meta property="og:image" content="/assets/images/yarn-berry-monorepo.png" />
    <title>yarn berry로 구성하는 monorepo | Code Logs</title>
    <meta name="next-head-count" content="16" />
    <link rel="preload" href="/_next/static/css/e67f92fc328a3d57.css" as="style" />
    <link rel="stylesheet" href="/_next/static/css/e67f92fc328a3d57.css" data-n-g="" />
    <link rel="preload" href="/_next/static/css/b5e8827db00c1c2b.css" as="style" />
    <link rel="stylesheet" href="/_next/static/css/b5e8827db00c1c2b.css" data-n-p="" />
    <noscript data-n-css=""></noscript>
    <script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script>
    <script src="/_next/static/chunks/webpack-2e51481b1d484a05.js" defer=""></script>
    <script src="/_next/static/chunks/framework-5f4595e5518b5600.js" defer=""></script>
    <script src="/_next/static/chunks/main-a4d9e436b9a532ca.js" defer=""></script>
    <script src="/_next/static/chunks/pages/_app-302687a3b3726e89.js" defer=""></script>
    <script src="/_next/static/chunks/294-6603e2d70ff7953e.js" defer=""></script>
    <script src="/_next/static/chunks/377-4e10e187c9e31bb8.js" defer=""></script>
    <script src="/_next/static/chunks/pages/%5Btitle%5D-637c57b2312d7084.js" defer=""></script>
    <script src="/_next/static/QDAY7vOzNGoWydfRLi_Nd/_buildManifest.js" defer=""></script>
    <script src="/_next/static/QDAY7vOzNGoWydfRLi_Nd/_ssgManifest.js" defer=""></script>
    <script src="/_next/static/QDAY7vOzNGoWydfRLi_Nd/_middlewareManifest.js" defer=""></script>
  </head>
  <body>
    <div id="__next" data-reactroot="">
      <header class="Header_header__RW35m">
        <p class="Header_title__GPS8b">Code Logs</p>
        <ul class="Header_socialIcons__CBf_s">
          <li>
            <a href="https://github.com/possible819" target="_blank" rel="noreferrer" aria-label="My Github"
              ><style data-emotion="css vubbuv">
                .css-vubbuv {
                  -webkit-user-select: none;
                  -moz-user-select: none;
                  -ms-user-select: none;
                  user-select: none;
                  width: 1em;
                  height: 1em;
                  display: inline-block;
                  fill: currentColor;
                  -webkit-flex-shrink: 0;
                  -ms-flex-negative: 0;
                  flex-shrink: 0;
                  -webkit-transition: fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
                  transition: fill 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
                  font-size: 1.5rem;
                }</style
              ><svg
                class="MuiSvgIcon-root MuiSvgIcon-fontSizeMedium css-vubbuv"
                focusable="false"
                aria-hidden="true"
                viewBox="0 0 24 24"
                data-testid="GitHubIcon"
              >
                <path
                  d="M12 1.27a11 11 0 00-3.48 21.46c.55.09.73-.28.73-.55v-1.84c-3.03.64-3.67-1.46-3.67-1.46-.55-1.29-1.28-1.65-1.28-1.65-.92-.65.1-.65.1-.65 1.1 0 1.73 1.1 1.73 1.1.92 1.65 2.57 1.2 3.21.92a2 2 0 01.64-1.47c-2.47-.27-5.04-1.19-5.04-5.5 0-1.1.46-2.1 1.2-2.84a3.76 3.76 0 010-2.93s.91-.28 3.11 1.1c1.8-.49 3.7-.49 5.5 0 2.1-1.38 3.02-1.1 3.02-1.1a3.76 3.76 0 010 2.93c.83.74 1.2 1.74 1.2 2.94 0 4.21-2.57 5.13-5.04 5.4.45.37.82.92.82 2.02v3.03c0 .27.1.64.73.55A11 11 0 0012 1.27"
                ></path></svg
            ></a>
          </li>
        </ul>
        <nav class="NavBar_navBar__akqA3">
          <ul>
            <li><a class="MarkedAnchor_anchor__QCmkL" href="https://code-logs.github.io/">Home</a></li>
            <li><a class="MarkedAnchor_anchor__QCmkL" href="https://code-logs.github.io/posts/1">Posts</a></li>
            <li><a class="MarkedAnchor_anchor__QCmkL" href="https://code-logs.github.io/about">About</a></li>
          </ul>
        </nav>
      </header>
      <main>
        <article class="PostDetail_container__Ma_26">
          <p class="PostDetail_publishedAt__7GOQm"><span></span></p>
          <section class="PostDetail_thumbnailWrapper__oALCg">
            <img src="/assets/images/yarn-berry-monorepo.png" alt="yarn berry와 yarn workspaces를 이용해 monorepo 구성 - 환경 설정, 샘플 프로젝트" />
          </section>
          <section>
            <h1>yarn berry로 구성하는 monorepo</h1>
            <p class="PostDetail_description__l6wHC">yarn berry와 yarn workspaces를 이용해 monorepo 구성 - 환경 설정, 샘플 프로젝트</p>
          </section>
          <section>
            <h2 id="table-of-content">Table of content</h2>
            <ol>
              <li><a href="#yarn-berry-%ED%99%9C%EC%84%B1%ED%99%94">Yarn berry 활성화</a></li>
              <li><a href="#workspace-%EA%B5%AC%EC%84%B1">Workspace 구성</a></li>
              <li>
                <a href="#react-library-%ED%8C%A8%ED%82%A4%EC%A7%80-%EC%B6%94%EA%B0%80">React library 패키지 추가</a>
                <ol>
                  <li>
                    <a href="#%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EA%B5%AC%EC%84%B1-%EB%B0%8F-%EB%94%94%ED%8E%9C%EB%8D%98%EC%8B%9C-%EC%84%A4%EC%B9%98"
                      >디렉토리 구성 및 디펜던시 설치</a
                    >
                  </li>
                  <li>
                    <a
                      href="#%EB%B2%84%ED%8A%BC-%EC%BB%B4%ED%8D%BC%EB%84%8C%ED%8A%B8-%EC%83%9D%EC%84%B1-%EB%B0%8F-%EB%B9%8C%EB%93%9C-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%84%B1"
                      >버튼 컴퍼넌트 생성 및 빌드 환경 구성</a
                    >
                  </li>
                  <li><a href="#typescript-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95">Typescript 환경 설정</a></li>
                  <li><a href="#%EB%B9%8C%EB%93%9C-%EA%B5%AC%EC%84%B1">빌드 구성</a></li>
                </ol>
              </li>
              <li>
                <a href="#utility-library-%EC%B6%94%EA%B0%80">Utility library 추가</a>
                <ol>
                  <li>
                    <a
                      href="#%EA%B8%B0%EB%B3%B8-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EA%B5%AC%EC%84%B1-%EB%B0%8F-%EB%94%94%ED%8E%9C%EB%8D%98%EC%8B%9C-%EC%84%A4%EC%B9%98"
                      >기본 디렉토리 구성 및 디펜던시 설치</a
                    >
                  </li>
                  <li><a href="#%EA%B5%AC%ED%98%84-%EB%B0%8F-%EB%B9%8C%EB%93%9C-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%84%B1">구현 및 빌드 환경 구성</a></li>
                </ol>
              </li>
              <li>
                <a
                  href="#%EC%97%AC%EB%9F%AC-%ED%8C%A8%ED%82%A4%EC%A7%80-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%ED%95%9C%EB%B2%88%EC%97%90-%EC%8B%A4%ED%96%89%ED%95%98%EA%B8%B0"
                  >여러 패키지 스크립트 한번에 실행하기</a
                >
              </li>
              <li><a href="#%EB%A1%9C%EC%BB%AC-%ED%8C%A8%ED%82%A4%EC%A7%80-%EC%B0%B8%EC%A1%B0%ED%95%98%EA%B8%B0">로컬 패키지 참조하기</a></li>
              <li><a href="#zero-install">Zero-install</a></li>
            </ol>
            <h2 id="yarn-berry-활성화">Yarn berry 활성화</h2>
            <p>yarn berry는 일반적인 yarn 환경과의 충돌을 방지하기 위해 적용하고자 하는 디렉토리에서 아래의 커맨드를 통해 활성화 할 수 있다.</p>
            <pre><code class="language-bash">yarn set version berry
</code></pre>
            <p>
              Yarn berry를 활성화하게 되면 몇가지 파일이 자동적으로 생성되는데 디펜던시를 관리하기 위한 metadata (.pnp.cjs)와 현재 <code>workspace</code> (root
              디렉토리도 결국 하나의 workspace와 같다)의 설정들 (설치된 plugins, sdk 등) 그리고 가장 중요한 압축된 형식의 디펜던시들이다.
            </p>
            <p>
              yarn berry를 이용하는 것은 디펜던시를 node_modules 디렉토리에 저장하는 것이 아닌 압축된 파일로 저장하게 되고 패키지의 디펜던시 참조 관계를 하나의
              파일을 통해 확인한다. (.pnp.cjs 파일은 디펜던시 추가 이후 생성됨) 이를 통해 예전의 상위 디렉토리로 올라가며 node_modules를 탐색하던 방식의 성능이
              획기적으로 개선된다.
            </p>
            <h2 id="workspace-구성">Workspace 구성</h2>
            <p>workspace 구성을 위해선 프로젝트 root 디렉토리의 <code>package.json</code> 파일을 수정해야 한다.</p>
            <pre><code class="language-json">{
  &quot;worskpaces&quot;: [&quot;packages/*&quot;]
}
</code></pre>
            <p>상기 설정은 <code>packages</code> 디렉토리 하위의 모든 디렉토리를 패키지로 본다.</p>
            <p>
              만약 한 depth 더 들어가게 구성하고 싶을 경우 (예를들어 <code>components</code>, <code>utils</code> 와 같이 유형에 따라 디렉토리를 달리하고 싶을
              경우) 아래와 같이 설정해야한다.
            </p>
            <pre><code class="language-json">{
    &quot;workspaces&quot;: [&quot;packages/components/*&quot;, &quot;packages/utils/*&quot;]
}

or

{
    &quot;workspaces&quot;: [&quot;packages/*/*&quot;]
}
</code></pre>
            <p>상기 설정과 동일한 형태의 디렉토리 구조를 생성하고 아래의 커맨드를 통해 현재 구성된 워크스페이스의 리스트를 확인한다.</p>
            <pre><code class="language-bash">yarn workspaces list
</code></pre>
            <blockquote>
              <p>디렉토리 구조를 정상적으로 만들었더라도 참조할 하위 <code>package.json</code> 파일이 존재하지 않으면 workspace를 인식 할 수 없다.</p>
            </blockquote>
            <h2 id="react-library-패키지-추가">React library 패키지 추가</h2>
            <h3 id="디렉토리-구성-및-디펜던시-설치">디렉토리 구성 및 디펜던시 설치</h3>
            <p>앞서 설정한 workspace 경로에 근거하여 적절한 위치에 추가하고자하는 react library 디렉토리를 구성한다.</p>
            <p>본 설명에서는 <code>root/packages/components/button</code> 경로에 button 컴퍼넌트를 만든다.</p>
            <p>패키지 디렉토리로 이동해 <code>package.json</code> 를 생성한다.</p>
            <pre><code class="language-bash">cd packages/components
mkdir button &amp;&amp; cd $_
yarn init
</code></pre>
            <p>필요한 디펜던시를 설치한다.</p>
            <p>package.json을 생성한 이후로는 <code>yarn workspace</code> 커맨드를 이용해 직접 디렉토리를 오가며 작업하지 않아도 된다.</p>
            <pre><code class="language-bash">yarn workspace button add react
yarn workspace button add -D @types/react typescript
</code></pre>
            <h3 id="버튼-컴퍼넌트-생성-및-빌드-환경-구성">버튼 컴퍼넌트 생성 및 빌드 환경 구성</h3>
            <p>button 컴퍼넌트를 만든다. (버튼을 만드는 특별한 방법이 있지 않기 때문에 상술하지 않는다. 일반적인 컴퍼넌트 만들기와 다르지 않다)</p>
            <p>빌드 환경을 구성하기 위해 tsconfig.json 파일을 만든다.</p>
            <p>각 패키지별로 tsconfig.json 파일을 각자 가지고 있을 수 있지만 workspace를 통해 공통 속성은 공유 하도록 구성하려한다.</p>
            <p>root 디렉토리에 <code>tsconfig.base.json</code> 파일을 생성한다. 이 파일에 공통 속성을 넣는다.</p>
            <pre><code class="language-json">{
  &quot;compilerOptions&quot;: {
    &quot;target&quot;: &quot;es5&quot;,
    &quot;module&quot;: &quot;esnext&quot;,
    &quot;esModuleInterop&quot;: true,
    &quot;forceConsistentCasingInFileNames&quot;: true,
    &quot;strict&quot;: true,
    &quot;skipLibCheck&quot;: true,
    &quot;moduleResolution&quot;: &quot;node&quot;
  }
}
</code></pre>
            <blockquote>
              <p>tsconfig.base.json의 내용은 당연히 환경에 따라 상이할 수 있으며 위 설정은 기본적인 내용만을 포함하고 있다.</p>
            </blockquote>
            <p>이제 button 컴퍼넌트 패키지 디렉토리에도 <code>tsconfig.json</code> 파일을 생성한다.</p>
            <pre><code class="language-json">{
  &quot;extends&quot;: &quot;../../../tsconfig.base.json&quot;,
  &quot;compilerOptions&quot;: {
    &quot;jsx&quot;: &quot;react-jsx&quot;,
    &quot;outDir&quot;: &quot;dist&quot;
  },
  &quot;include&quot;: [&quot;src&quot;]
}
</code></pre>
            <h3 id="typescript-환경-설정">Typescript 환경 설정</h3>
            <p>이제 Button 컴퍼넌트 파일을 열어보면 아래와 같이 에러가 발생한 것을 확인 할 수 있다.</p>
            <figure>
              <img src="/examples/infrastructure/yarn-berry-monorepo/001.png" alt="소스 코드 상에서 발생하는 에러" />
              <figcaption>소스 코드 상에서 발생하는 에러</figcaption>
            </figure>

            <p>
              이것은 코드상의 문제가 아니라 SDK(VSCode)의 모듈 참조 과정이 일반적이지 (기존 npm 또는 yarn과 다른 방식의 참조 방식을 사용하기 때문에) 않기
              때문인데 이것을 해결하기 위해 yarn의 플러그인과 SDK 호환을 위한 extension을 설치해야 한다.
            </p>
            <p>
              아래의 커맨드를 통해 SDK extension을 설치한다. (VSCode의 경우에 해당되며 yarn 공식 문서를 통해 다른 IDE를 사용할 경우에 대한 설명을 찾을 수 있다.)
            </p>
            <pre><code class="language-bash">yarn dlx @yarnpkg/sdks vscode
</code></pre>
            <p>설치가 정상적으로 마무리되면 <code>.yarn/sdks</code> 경로에 새롭게 추가된 파일을 확인 할 수 있다.</p>
            <p>그리고 vscode가 사용하는 typescript의 버전의 workspace에서 참조하도록 설정해야 한다.</p>
            <blockquote>
              <p>
                workspace의 typescript를 참조 할 수 없는 경우는 workspace root package.json이 typescript를 dependency로 가지고 있지 않을 경우이다.
                <code>yarn add typescript</code> 를 통해 디펜던시를 설치하게 되면 정상적으로 버전 선택이 가능하다.
              </p>
              <p>
                이렇게 @yarnpkg/sdks 설치 이후에 typescript를 설치 했다면 <code>yarn dlx @yarnpkg/sdks</code> 명령을 통해 extension을 다시 설치해 줘야 한다.
              </p>
            </blockquote>
            <p><code>cmd + shift + p ⇒ select typescript version ⇒ use workspace version</code></p>
            <h3 id="빌드-구성">빌드 구성</h3>
            <p>이 예제에서는 간단히 <code>tsc</code> 만 수행하도록 진행할 예정이다.</p>
            <p>button 디렉토리의 package.json 파일을 열어 아래의 스크립트를 추가한다.</p>
            <pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;tsc&quot;
  }
}
</code></pre>
            <p>아래의 커맨드를 실행하여 패키지 내부의 스크립트를 실행한다.</p>
            <pre><code class="language-bash">yarn workspace button build
</code></pre>
            <p>빌드가 정상적으로 완료되면 <code>dist</code> 디렉토리 아래에 파일이 생성될 것이다.</p>
            <h2 id="utility-library-추가">Utility library 추가</h2>
            <h3 id="기본-디렉토리-구성-및-디펜던시-설치">기본 디렉토리 구성 및 디펜던시 설치</h3>
            <p>본 예제에서는 스트링을 Capitalize 하는 라이브러리를 만드는 것을 예제로 한다.</p>
            <p>
              <code>root/packages/utils/capitalize</code> 디렉토리를 생성하고 앞서 react 컴퍼넌트 생성과 동일한 방법으로 <code>package.json</code> 파일까지
              만들어 준다.
            </p>
            <p>마찬가지로 필요한 디펜던시를 설치한다. 예제의 경우 아래와 같다</p>
            <pre><code class="language-bash">yarn workspace capitalize add -D typescript
</code></pre>
            <h3 id="구현-및-빌드-환경-구성">구현 및 빌드 환경 구성</h3>
            <p>문자를 전달 받아 대문자화 한 뒤 리턴하는 유틸리티 함수를 만들고 외부에서 사용 할 수 있도록 export 해준다.</p>
            <pre><code class="language-tsx">// root/utils/capitalize/index.ts

const capitalize = (text: string) =&gt; text.toUpperCase()

export default capitalize
</code></pre>
            <p>
              이제 <code>tsconfig.json</code> 를 만든다 리엑트 컴퍼넌트 개발과 동일한 방식으로 root 디렉토리의 <code>tsconfig.base.json</code> 을 참조하도록
              구성한다.
            </p>
            <p>필요한 설정들이 있다면 추가한다.</p>
            <p>capitalize 패키지의 package.json 파일을 열고 아래의 빌드 스크립트를 추가한다.</p>
            <pre><code class="language-json">{
  &quot;scripts&quot;: {
    &quot;build&quot;: &quot;tsc&quot;
  }
}
</code></pre>
            <blockquote>
              <p>
                앞서 설정한 리엑트 컴퍼넌트의 빌드 커맨드와 동일한 명칭으로 생성하는 것이 좋다. 이후에 일괄적으로 스크립트를 실행하려면 동일한 이름을 기준으로
                일괄 처리가 되기 때문이다. 물론 내용은 달라져도 된다.
              </p>
            </blockquote>
            <p>스크립트를 작성한 뒤 아래의 명령어를 통해 빌드를 수행하고 확인한다.</p>
            <h2 id="여러-패키지-스크립트-한번에-실행하기">여러 패키지 스크립트 한번에 실행하기</h2>
            <p>경우에 따라 모든 패키지를 순회하며 스크립트를 실행해야 할 때가 있다. (전체 패키지 빌드, 테스트 등)</p>
            <p>이런 작업을 <code>lerna</code> 를 통해 수행할 수 있지만 yarn workspaces에서도 plugin을 통해 해당 기능을 사용 할 수 있다.</p>
            <p>우선 plugin을 설치해야 하기 위해 아래의 커맨드를 입력한다.</p>
            <pre><code class="language-bash">yarn plugin import plugin-workspace-tools
</code></pre>
            <blockquote>
              <p>
                <code>yarn plugin list</code> 명렁을 통해 공식적으로 제공되는 plugin 리스트를 조회 할 수 있다. 더불어 plugin을 직접 개발해서 쓰기도 쉽다고하니
                필요한 경우 고려해 볼만하다.
              </p>
            </blockquote>
            <p>플러그인이 정상적으로 임포트 되면 <code>.yarn</code> 디렉토리를 통해 해당 사항을 확인 할 수 있고</p>
            <p>아래의 명령어를 사용 할 수 있다.</p>
            <pre><code class="language-bash">yarn workspaces foreach run build
</code></pre>
            <blockquote>
              <p>
                그 밖의 커맨드로는 <code>focus</code> 도 있다 사용법 및 역할은
                <a href="https://github.com/yarnpkg/berry/blob/HEAD/packages/plugin-workspace-tools/README.md">공식문서</a>를 참조
              </p>
            </blockquote>
            <h2 id="로컬-패키지-참조하기">로컬 패키지 참조하기</h2>
            <p>
              이제 <code>Button</code> 컴퍼넌트에서 <code>capitalize</code> 유틸리티를 참조하도록 설정한다. monorep 구성의 궁극적인 목적은 로컬 패키지의
              변경사항을 즉각적으로 다른 로컬 패키지에 적용하기 위함이다.
            </p>
            <p>monorepo의 구성이 없다면 변경사항을 publishing하고 다시 다운 받는등 번거로운 작업을 수행해야하기 때문이데</p>
            <p>button 컴퍼넌트 패키지의 package.json 파일을 열고 디펜던시를 추가한다.</p>
            <pre><code class="language-json">{
  &quot;dependencies&quot;: {
    &quot;capitalize&quot;: &quot;workspace:*&quot;,
    &quot;react&quot;: &quot;^17.0.2&quot;
  }
}
</code></pre>
            <p>디펜던시를 추가 할 때 사용하는 <code>workspace:*</code> 버전 range를 통해 해당 패키지가 로컬 저장소에서 부터 참조된다는 것을 명시한다.</p>
            <p>디펜던시 항목을 수정한 뒤에는 반드시 <code>yarn install</code> 을 실행해서 디펜던시 참조 관계를 다시 불러와야 한다.</p>
            <p>불러온 패키지를 Button 컴퍼넌트가 사용하도록 수정한 뒤 정상적으로 빌드가 되는지 확인한다.</p>
            <blockquote>
              <p>
                이렇게 설정된 로컬 디펜던시의 버전은 실제 <code>yarn (npm) publish</code> 또는 <code>yarn pack</code> 명령이 실행될 때 remote에서 사용 할 수
                있는 버전으로 자동변환된다.
              </p>
            </blockquote>
            <h2 id="zero-install">Zero-install</h2>
            <p>
              zero install은 어렵게 생각할 것이 전혀 없다. 이미 한번 설치된 패키지를 통채로 저장소에 업로드 하는 것이다. 기존의 node_modules를 이용한 디펜던시
              참조는 중복된 디펜던시를 설치하고 패키지의 내용이 커서 저장소에 올리는 일이 경우에 따라 불가능에 가까웠기 때문인데 yarn berry의 새로운 디펜던시
              참조 설정을 통해 이것이 가능하게 됐다.
            </p>
            <p>아래의 두가지 <code>.gitignore</code> 파일을 참조하여 zero-install 설정과 non-zero-install 설정의 차이를 살펴본다.</p>
            <pre><code class="language-bash"># Zero install

.yarn/*
!.yarn/cache
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/sdks
!.yarn/versions
</code></pre>
            <pre><code class="language-bash"># Non Zero Install
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/sdks
!.yarn/versions
.pnp.*
</code></pre>
            <p>
              Zero install 설정을 진행 할 경우 <code>.pnp.*</code> 파일 (디펜던시의 참조 관계가 저장된 metadata)이 커밋 대상이 되고 <code>.yarn/cache</code> 의
              내용이 커밋 대상이 되는 것을 확인 할 수 있다.
            </p>
            <p>결과적으로 yarn install을 통해 생성 할 수 있는 파일과 설치 결과 자체를 저장소의 커밋 대상으로 만든다고 볼 수 있다.</p>
          </section>
        </article>
        <section class="PostDetail_relatedPosting__VlXXV">
          <h2>연관 포스팅</h2>
          <dl class="PostSeriesLink_container__jtRUh">
            <a href="https://code-logs.github.io/nx-build-system-%EB%A7%9B%EB%B3%B4%EA%B8%B0"
              ><dt>
                <span>이전글 - </span>
                <h3>Nx build system 맛보기</h3>
              </dt>
              <dd>Nx build system을 이용한 Monorepo 구성하기</dd></a
            >
          </dl>
        </section>
        <section class="PostDetail_categoryGroup___S2ib">
          <h2>카테고리 더보기</h2>
          <dl class="CategoryPostGroup_container__MDFUe"></dl>
        </section>
        <section class="PostDetail_references__EU_hH">
          <h2>참고</h2>
          <ul class="PostDetail_references__EU_hH">
            <li><a href="https%3A%2F%2Fyarnpkg.com%2Ffeatures%2Fworkspaces" target="_blank" rel="noreferrer">yarn workspaces</a></li>
          </ul>
        </section>
        <section class="PostDetail_utterances__jZeOm">
          <h2>댓글</h2>
          <div></div>
        </section>
        <ins
          class="adsbygoogle"
          style="display: block"
          data-ad-client="ca-pub-7134579063537339"
          data-ad-slot="5391522351"
          data-ad-format="auto"
          data-full-width-responsive="true"
        ></ins>
      </main>
      <aside></aside>
      <footer class="Footer_footer__GLL0J"><p>ⓒ 2021. Jay Lee all rights reserved.</p></footer>
    </div>
    <script id="__NEXT_DATA__" type="application/json">
      {
        "props": {
          "pageProps": {
            "post": {
              "title": "yarn berry로 구성하는 monorepo",
              "description": "yarn berry와 yarn workspaces를 이용해 monorepo 구성 - 환경 설정, 샘플 프로젝트",
              "fileName": "yarn-berry-monorepo.md",
              "category": "infrastructure",
              "published": true,
              "publishedAt": "2022-02-26",
              "thumbnailName": "yarn-berry-monorepo.png",
              "tags": ["berry", "monorepo", "workspace", "workspaces", "yarn", "yarn berry", "zero-install", "모노리포"],
              "references": [{ "title": "yarn workspaces", "url": "https://yarnpkg.com/features/workspaces" }],
              "series": { "prevPostTitle": "Nx build system 맛보기" }
            },
            "content": "\u003ch2 id=\"table-of-content\"\u003eTable of content\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"#yarn-berry-%ED%99%9C%EC%84%B1%ED%99%94\"\u003eYarn berry 활성화\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#workspace-%EA%B5%AC%EC%84%B1\"\u003eWorkspace 구성\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#react-library-%ED%8C%A8%ED%82%A4%EC%A7%80-%EC%B6%94%EA%B0%80\"\u003eReact library 패키지 추가\u003c/a\u003e\u003col\u003e\n\u003cli\u003e\u003ca href=\"#%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EA%B5%AC%EC%84%B1-%EB%B0%8F-%EB%94%94%ED%8E%9C%EB%8D%98%EC%8B%9C-%EC%84%A4%EC%B9%98\"\u003e디렉토리 구성 및 디펜던시 설치\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%EB%B2%84%ED%8A%BC-%EC%BB%B4%ED%8D%BC%EB%84%8C%ED%8A%B8-%EC%83%9D%EC%84%B1-%EB%B0%8F-%EB%B9%8C%EB%93%9C-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%84%B1\"\u003e버튼 컴퍼넌트 생성 및 빌드 환경 구성\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#typescript-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95\"\u003eTypescript 환경 설정\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%EB%B9%8C%EB%93%9C-%EA%B5%AC%EC%84%B1\"\u003e빌드 구성\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#utility-library-%EC%B6%94%EA%B0%80\"\u003eUtility library 추가\u003c/a\u003e\u003col\u003e\n\u003cli\u003e\u003ca href=\"#%EA%B8%B0%EB%B3%B8-%EB%94%94%EB%A0%89%ED%86%A0%EB%A6%AC-%EA%B5%AC%EC%84%B1-%EB%B0%8F-%EB%94%94%ED%8E%9C%EB%8D%98%EC%8B%9C-%EC%84%A4%EC%B9%98\"\u003e기본 디렉토리 구성 및 디펜던시 설치\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%EA%B5%AC%ED%98%84-%EB%B0%8F-%EB%B9%8C%EB%93%9C-%ED%99%98%EA%B2%BD-%EA%B5%AC%EC%84%B1\"\u003e구현 및 빌드 환경 구성\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%EC%97%AC%EB%9F%AC-%ED%8C%A8%ED%82%A4%EC%A7%80-%EC%8A%A4%ED%81%AC%EB%A6%BD%ED%8A%B8-%ED%95%9C%EB%B2%88%EC%97%90-%EC%8B%A4%ED%96%89%ED%95%98%EA%B8%B0\"\u003e여러 패키지 스크립트 한번에 실행하기\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#%EB%A1%9C%EC%BB%AC-%ED%8C%A8%ED%82%A4%EC%A7%80-%EC%B0%B8%EC%A1%B0%ED%95%98%EA%B8%B0\"\u003e로컬 패키지 참조하기\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"#zero-install\"\u003eZero-install\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch2 id=\"yarn-berry-활성화\"\u003eYarn berry 활성화\u003c/h2\u003e\n\u003cp\u003eyarn berry는 일반적인 yarn 환경과의 충돌을 방지하기 위해 적용하고자 하는 디렉토리에서 아래의 커맨드를 통해 활성화 할 수 있다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eyarn set version berry\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eYarn berry를 활성화하게 되면 몇가지 파일이 자동적으로 생성되는데 디펜던시를 관리하기 위한 metadata (.pnp.cjs)와 현재 \u003ccode\u003eworkspace\u003c/code\u003e (root 디렉토리도 결국 하나의 workspace와 같다)의 설정들 (설치된 plugins, sdk 등) 그리고 가장 중요한 압축된 형식의 디펜던시들이다.\u003c/p\u003e\n\u003cp\u003eyarn berry를 이용하는 것은 디펜던시를 node_modules 디렉토리에 저장하는 것이 아닌 압축된 파일로 저장하게 되고 패키지의 디펜던시 참조 관계를 하나의 파일을 통해 확인한다. (.pnp.cjs 파일은 디펜던시 추가 이후 생성됨) 이를 통해 예전의 상위 디렉토리로 올라가며 node_modules를 탐색하던 방식의 성능이 획기적으로 개선된다.\u003c/p\u003e\n\u003ch2 id=\"workspace-구성\"\u003eWorkspace 구성\u003c/h2\u003e\n\u003cp\u003eworkspace 구성을 위해선 프로젝트 root 디렉토리의 \u003ccode\u003epackage.json\u003c/code\u003e 파일을 수정해야 한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e{\n  \u0026quot;worskpaces\u0026quot;: [\u0026quot;packages/*\u0026quot;]\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e상기 설정은 \u003ccode\u003epackages\u003c/code\u003e 디렉토리 하위의 모든 디렉토리를 패키지로 본다.\u003c/p\u003e\n\u003cp\u003e만약 한 depth 더 들어가게 구성하고 싶을 경우 (예를들어 \u003ccode\u003ecomponents\u003c/code\u003e, \u003ccode\u003eutils\u003c/code\u003e 와 같이 유형에 따라 디렉토리를 달리하고 싶을 경우) 아래와 같이 설정해야한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e{\n    \u0026quot;workspaces\u0026quot;: [\u0026quot;packages/components/*\u0026quot;, \u0026quot;packages/utils/*\u0026quot;]\n}\n\nor\n\n{\n    \u0026quot;workspaces\u0026quot;: [\u0026quot;packages/*/*\u0026quot;]\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e상기 설정과 동일한 형태의 디렉토리 구조를 생성하고 아래의 커맨드를 통해 현재 구성된 워크스페이스의 리스트를 확인한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eyarn workspaces list\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e디렉토리 구조를 정상적으로 만들었더라도 참조할 하위 \u003ccode\u003epackage.json\u003c/code\u003e 파일이 존재하지 않으면 workspace를 인식 할 수 없다.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"react-library-패키지-추가\"\u003eReact library 패키지 추가\u003c/h2\u003e\n\u003ch3 id=\"디렉토리-구성-및-디펜던시-설치\"\u003e디렉토리 구성 및 디펜던시 설치\u003c/h3\u003e\n\u003cp\u003e앞서 설정한 workspace 경로에 근거하여 적절한 위치에 추가하고자하는 react library 디렉토리를 구성한다.\u003c/p\u003e\n\u003cp\u003e본 설명에서는 \u003ccode\u003eroot/packages/components/button\u003c/code\u003e 경로에 button 컴퍼넌트를 만든다.\u003c/p\u003e\n\u003cp\u003e패키지 디렉토리로 이동해 \u003ccode\u003epackage.json\u003c/code\u003e 를 생성한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003ecd packages/components\nmkdir button \u0026amp;\u0026amp; cd $_\nyarn init\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e필요한 디펜던시를 설치한다.\u003c/p\u003e\n\u003cp\u003epackage.json을 생성한 이후로는 \u003ccode\u003eyarn workspace\u003c/code\u003e 커맨드를 이용해 직접 디렉토리를 오가며 작업하지 않아도 된다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eyarn workspace button add react\nyarn workspace button add -D @types/react typescript\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"버튼-컴퍼넌트-생성-및-빌드-환경-구성\"\u003e버튼 컴퍼넌트 생성 및 빌드 환경 구성\u003c/h3\u003e\n\u003cp\u003ebutton 컴퍼넌트를 만든다. (버튼을 만드는 특별한 방법이 있지 않기 때문에 상술하지 않는다. 일반적인 컴퍼넌트 만들기와 다르지 않다)\u003c/p\u003e\n\u003cp\u003e빌드 환경을 구성하기 위해 tsconfig.json 파일을 만든다.\u003c/p\u003e\n\u003cp\u003e각 패키지별로 tsconfig.json 파일을 각자 가지고 있을 수 있지만 workspace를 통해 공통 속성은 공유 하도록 구성하려한다.\u003c/p\u003e\n\u003cp\u003eroot 디렉토리에 \u003ccode\u003etsconfig.base.json\u003c/code\u003e 파일을 생성한다. 이 파일에 공통 속성을 넣는다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e{\n  \u0026quot;compilerOptions\u0026quot;: {\n    \u0026quot;target\u0026quot;: \u0026quot;es5\u0026quot;,\n    \u0026quot;module\u0026quot;: \u0026quot;esnext\u0026quot;,\n    \u0026quot;esModuleInterop\u0026quot;: true,\n    \u0026quot;forceConsistentCasingInFileNames\u0026quot;: true,\n    \u0026quot;strict\u0026quot;: true,\n    \u0026quot;skipLibCheck\u0026quot;: true,\n    \u0026quot;moduleResolution\u0026quot;: \u0026quot;node\u0026quot;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003etsconfig.base.json의 내용은 당연히 환경에 따라 상이할 수 있으며 위 설정은 기본적인 내용만을 포함하고 있다.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e이제 button 컴퍼넌트 패키지 디렉토리에도 \u003ccode\u003etsconfig.json\u003c/code\u003e 파일을 생성한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e{\n  \u0026quot;extends\u0026quot;: \u0026quot;../../../tsconfig.base.json\u0026quot;,\n  \u0026quot;compilerOptions\u0026quot;: {\n    \u0026quot;jsx\u0026quot;: \u0026quot;react-jsx\u0026quot;,\n    \u0026quot;outDir\u0026quot;: \u0026quot;dist\u0026quot;\n  },\n  \u0026quot;include\u0026quot;: [\u0026quot;src\u0026quot;]\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"typescript-환경-설정\"\u003eTypescript 환경 설정\u003c/h3\u003e\n\u003cp\u003e이제 Button 컴퍼넌트 파일을 열어보면 아래와 같이 에러가 발생한 것을 확인 할 수 있다.\u003c/p\u003e\n\u003cfigure\u003e\n  \u003cimg src=\"/examples/infrastructure/yarn-berry-monorepo/001.png\" alt=\"소스 코드 상에서 발생하는 에러\" /\u003e\n  \u003cfigcaption\u003e소스 코드 상에서 발생하는 에러\u003c/figcaption\u003e\n\u003c/figure\u003e\n\n\u003cp\u003e이것은 코드상의 문제가 아니라 SDK(VSCode)의 모듈 참조 과정이 일반적이지 (기존 npm 또는 yarn과 다른 방식의 참조 방식을 사용하기 때문에) 않기 때문인데 이것을 해결하기 위해 yarn의 플러그인과 SDK 호환을 위한 extension을 설치해야 한다.\u003c/p\u003e\n\u003cp\u003e아래의 커맨드를 통해 SDK extension을 설치한다. (VSCode의 경우에 해당되며 yarn 공식 문서를 통해 다른 IDE를 사용할 경우에 대한 설명을 찾을 수 있다.)\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eyarn dlx @yarnpkg/sdks vscode\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e설치가 정상적으로 마무리되면 \u003ccode\u003e.yarn/sdks\u003c/code\u003e 경로에 새롭게 추가된 파일을 확인 할 수 있다.\u003c/p\u003e\n\u003cp\u003e그리고 vscode가 사용하는 typescript의 버전의 workspace에서 참조하도록 설정해야 한다.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eworkspace의 typescript를 참조 할 수 없는 경우는 workspace root package.json이 typescript를 dependency로 가지고 있지 않을 경우이다.\n\u003ccode\u003eyarn add typescript\u003c/code\u003e 를 통해 디펜던시를 설치하게 되면 정상적으로 버전 선택이 가능하다.\u003c/p\u003e\n\u003cp\u003e이렇게 @yarnpkg/sdks 설치 이후에 typescript를 설치 했다면 \u003ccode\u003eyarn dlx @yarnpkg/sdks\u003c/code\u003e 명령을 통해 extension을 다시 설치해 줘야 한다.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e\u003ccode\u003ecmd + shift + p ⇒ select typescript version ⇒ use workspace version\u003c/code\u003e\u003c/p\u003e\n\u003ch3 id=\"빌드-구성\"\u003e빌드 구성\u003c/h3\u003e\n\u003cp\u003e이 예제에서는 간단히 \u003ccode\u003etsc\u003c/code\u003e 만 수행하도록 진행할 예정이다.\u003c/p\u003e\n\u003cp\u003ebutton 디렉토리의 package.json 파일을 열어 아래의 스크립트를 추가한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e{\n  \u0026quot;scripts\u0026quot;: {\n    \u0026quot;build\u0026quot;: \u0026quot;tsc\u0026quot;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e아래의 커맨드를 실행하여 패키지 내부의 스크립트를 실행한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eyarn workspace button build\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e빌드가 정상적으로 완료되면 \u003ccode\u003edist\u003c/code\u003e 디렉토리 아래에 파일이 생성될 것이다.\u003c/p\u003e\n\u003ch2 id=\"utility-library-추가\"\u003eUtility library 추가\u003c/h2\u003e\n\u003ch3 id=\"기본-디렉토리-구성-및-디펜던시-설치\"\u003e기본 디렉토리 구성 및 디펜던시 설치\u003c/h3\u003e\n\u003cp\u003e본 예제에서는 스트링을 Capitalize 하는 라이브러리를 만드는 것을 예제로 한다.\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eroot/packages/utils/capitalize\u003c/code\u003e 디렉토리를 생성하고 앞서 react 컴퍼넌트 생성과 동일한 방법으로 \u003ccode\u003epackage.json\u003c/code\u003e 파일까지 만들어 준다.\u003c/p\u003e\n\u003cp\u003e마찬가지로 필요한 디펜던시를 설치한다. 예제의 경우 아래와 같다\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eyarn workspace capitalize add -D typescript\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"구현-및-빌드-환경-구성\"\u003e구현 및 빌드 환경 구성\u003c/h3\u003e\n\u003cp\u003e문자를 전달 받아 대문자화 한 뒤 리턴하는 유틸리티 함수를 만들고 외부에서 사용 할 수 있도록 export 해준다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-tsx\"\u003e// root/utils/capitalize/index.ts\n\nconst capitalize = (text: string) =\u0026gt; text.toUpperCase()\n\nexport default capitalize\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e이제 \u003ccode\u003etsconfig.json\u003c/code\u003e 를 만든다 리엑트 컴퍼넌트 개발과 동일한 방식으로 root 디렉토리의 \u003ccode\u003etsconfig.base.json\u003c/code\u003e 을 참조하도록 구성한다.\u003c/p\u003e\n\u003cp\u003e필요한 설정들이 있다면 추가한다.\u003c/p\u003e\n\u003cp\u003ecapitalize 패키지의 package.json 파일을 열고 아래의 빌드 스크립트를 추가한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e{\n  \u0026quot;scripts\u0026quot;: {\n    \u0026quot;build\u0026quot;: \u0026quot;tsc\u0026quot;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e앞서 설정한 리엑트 컴퍼넌트의 빌드 커맨드와 동일한 명칭으로 생성하는 것이 좋다.\n이후에 일괄적으로 스크립트를 실행하려면 동일한 이름을 기준으로 일괄 처리가 되기 때문이다.\n물론 내용은 달라져도 된다.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e스크립트를 작성한 뒤 아래의 명령어를 통해 빌드를 수행하고 확인한다.\u003c/p\u003e\n\u003ch2 id=\"여러-패키지-스크립트-한번에-실행하기\"\u003e여러 패키지 스크립트 한번에 실행하기\u003c/h2\u003e\n\u003cp\u003e경우에 따라 모든 패키지를 순회하며 스크립트를 실행해야 할 때가 있다. (전체 패키지 빌드, 테스트 등)\u003c/p\u003e\n\u003cp\u003e이런 작업을 \u003ccode\u003elerna\u003c/code\u003e 를 통해 수행할 수 있지만 yarn workspaces에서도 plugin을 통해 해당 기능을 사용 할 수 있다.\u003c/p\u003e\n\u003cp\u003e우선 plugin을 설치해야 하기 위해 아래의 커맨드를 입력한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eyarn plugin import plugin-workspace-tools\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ccode\u003eyarn plugin list\u003c/code\u003e 명렁을 통해 공식적으로 제공되는 plugin 리스트를 조회 할 수 있다.\n더불어 plugin을 직접 개발해서 쓰기도 쉽다고하니 필요한 경우 고려해 볼만하다.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003cp\u003e플러그인이 정상적으로 임포트 되면 \u003ccode\u003e.yarn\u003c/code\u003e 디렉토리를 통해 해당 사항을 확인 할 수 있고\u003c/p\u003e\n\u003cp\u003e아래의 명령어를 사용 할 수 있다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003eyarn workspaces foreach run build\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e그 밖의 커맨드로는 \u003ccode\u003efocus\u003c/code\u003e 도 있다 사용법 및 역할은 \u003ca href=\"https://github.com/yarnpkg/berry/blob/HEAD/packages/plugin-workspace-tools/README.md\"\u003e공식문서\u003c/a\u003e를 참조\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"로컬-패키지-참조하기\"\u003e로컬 패키지 참조하기\u003c/h2\u003e\n\u003cp\u003e이제 \u003ccode\u003eButton\u003c/code\u003e 컴퍼넌트에서 \u003ccode\u003ecapitalize\u003c/code\u003e 유틸리티를 참조하도록 설정한다. monorep 구성의 궁극적인 목적은 로컬 패키지의 변경사항을 즉각적으로 다른 로컬 패키지에 적용하기 위함이다.\u003c/p\u003e\n\u003cp\u003emonorepo의 구성이 없다면 변경사항을 publishing하고 다시 다운 받는등 번거로운 작업을 수행해야하기 때문이데\u003c/p\u003e\n\u003cp\u003ebutton 컴퍼넌트 패키지의 package.json 파일을 열고 디펜던시를 추가한다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-json\"\u003e{\n  \u0026quot;dependencies\u0026quot;: {\n    \u0026quot;capitalize\u0026quot;: \u0026quot;workspace:*\u0026quot;,\n    \u0026quot;react\u0026quot;: \u0026quot;^17.0.2\u0026quot;\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e디펜던시를 추가 할 때 사용하는 \u003ccode\u003eworkspace:*\u003c/code\u003e 버전 range를 통해 해당 패키지가 로컬 저장소에서 부터 참조된다는 것을 명시한다.\u003c/p\u003e\n\u003cp\u003e디펜던시 항목을 수정한 뒤에는 반드시 \u003ccode\u003eyarn install\u003c/code\u003e 을 실행해서 디펜던시 참조 관계를 다시 불러와야 한다.\u003c/p\u003e\n\u003cp\u003e불러온 패키지를 Button 컴퍼넌트가 사용하도록 수정한 뒤 정상적으로 빌드가 되는지 확인한다.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003e이렇게 설정된 로컬 디펜던시의 버전은 실제 \u003ccode\u003eyarn (npm) publish\u003c/code\u003e 또는 \u003ccode\u003eyarn pack\u003c/code\u003e 명령이 실행될 때 remote에서 사용 할 수 있는 버전으로 자동변환된다.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2 id=\"zero-install\"\u003eZero-install\u003c/h2\u003e\n\u003cp\u003ezero install은 어렵게 생각할 것이 전혀 없다. 이미 한번 설치된 패키지를 통채로 저장소에 업로드 하는 것이다. 기존의 node_modules를 이용한 디펜던시 참조는 중복된 디펜던시를 설치하고 패키지의 내용이 커서 저장소에 올리는 일이 경우에 따라 불가능에 가까웠기 때문인데 yarn berry의 새로운 디펜던시 참조 설정을 통해 이것이 가능하게 됐다.\u003c/p\u003e\n\u003cp\u003e아래의 두가지 \u003ccode\u003e.gitignore\u003c/code\u003e 파일을 참조하여 zero-install 설정과 non-zero-install 설정의 차이를 살펴본다.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Zero install\n\n.yarn/*\n!.yarn/cache\n!.yarn/patches\n!.yarn/plugins\n!.yarn/releases\n!.yarn/sdks\n!.yarn/versions\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"language-bash\"\u003e# Non Zero Install\n.yarn/*\n!.yarn/patches\n!.yarn/plugins\n!.yarn/releases\n!.yarn/sdks\n!.yarn/versions\n.pnp.*\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eZero install 설정을 진행 할 경우 \u003ccode\u003e.pnp.*\u003c/code\u003e 파일 (디펜던시의 참조 관계가 저장된 metadata)이 커밋 대상이 되고 \u003ccode\u003e.yarn/cache\u003c/code\u003e 의 내용이 커밋 대상이 되는 것을 확인 할 수 있다.\u003c/p\u003e\n\u003cp\u003e결과적으로 yarn install을 통해 생성 할 수 있는 파일과 설치 결과 자체를 저장소의 커밋 대상으로 만든다고 볼 수 있다.\u003c/p\u003e\n",
            "postsByCategory": [
              {
                "title": "Nx build system 맛보기",
                "description": "Nx build system을 이용한 Monorepo 구성하기",
                "fileName": "monorepo-with-nx.md",
                "category": "infrastructure",
                "published": true,
                "publishedAt": "2022-02-12",
                "thumbnailName": "monorepo-with-nx.png",
                "tags": ["build", "build system", "monorepo", "nx", "모노리포", "빌드", "빌드 시스템"],
                "series": { "prevPostTitle": "Nx build system 맛보기", "nextPostTitle": "yarn berry로 구성하는 monorepo" }
              }
            ]
          },
          "__N_SSG": true
        },
        "page": "/[title]",
        "query": { "title": "yarn-berry로-구성하는-monorepo" },
        "buildId": "QDAY7vOzNGoWydfRLi_Nd",
        "isFallback": false,
        "gsp": true,
        "scriptLoader": []
      }
    </script>
  </body>
</html>
